mxcp: 1.0.0
tool:
  name: "geo_licenses"
  description: "Search UAE business licenses by location, with bounding box and deep filtering."
  tags: ["geo", "licenses", "uae", "deep-filters"]
  annotations:
    title: "Geo Licenses"
    readOnlyHint: true
    destructiveHint: false
    idempotentHint: true
    openWorldHint: false
  parameters:
    - { name: "bbox", type: "string", description: "Bounding box as 'lon_min,lat_min,lon_max,lat_max'", default: null, examples: ["54.0,24.0,56.0,25.0"] }
    - { name: "emirate_name_en", type: "string", description: "Emirate (EN) exact match", default: null }
    - { name: "emirate_name_en_like", type: "string", description: "Emirate (EN) substring match", default: null }
    - { name: "emirate_name_ar", type: "string", description: "Emirate (AR) exact match", default: null }
    - { name: "emirate_name_ar_like", type: "string", description: "Emirate (AR) substring match", default: null }
    - { name: "issuance_authority_en", type: "string", description: "Issuance authority (EN) exact match", default: null }
    - { name: "issuance_authority_en_like", type: "string", description: "Issuance authority (EN) substring match", default: null }
    - { name: "issuance_authority_ar", type: "string", description: "Issuance authority (AR) exact match", default: null }
    - { name: "issuance_authority_ar_like", type: "string", description: "Issuance authority (AR) substring match", default: null }
    - { name: "bl", type: "string", description: "License number exact match", default: null }
    - { name: "bl_like", type: "string", description: "License number substring match", default: null }
    - { name: "bl_status_en", type: "string", description: "License status (EN)", default: null }
    - { name: "bl_type_en", type: "string", description: "License type (EN)", default: null }
    - { name: "bl_legal_type_en", type: "string", description: "Legal type (EN)", default: null }
    - { name: "owner_nationality_en", type: "string", description: "Owner nationality (EN)", default: null }
    - { name: "relationship_type_en", type: "string", description: "Relationship type (EN)", default: null }
    - { name: "bl_est_date_d_from", type: "string", description: "Establishment date from (YYYY-MM-DD)", default: null }
    - { name: "bl_est_date_d_to", type: "string", description: "Establishment date to (YYYY-MM-DD)", default: null }
    - { name: "bl_exp_date_d_from", type: "string", description: "Expiry date from (YYYY-MM-DD)", default: null }
    - { name: "bl_exp_date_d_to", type: "string", description: "Expiry date to (YYYY-MM-DD)", default: null }
    - { name: "page_size", type: "integer", description: "Number of records per page", default: 20, minimum: 1, maximum: 1000 }
    - { name: "page", type: "integer", description: "Page number (1-based)", default: 1, minimum: 1 }
  return:
    type: array
    items:
      type: object
      properties:
        license_pk: { type: string }
        bl_name_en: { type: string }
        lat_dd: { type: number }
        lon_dd: { type: number }
        emirate_name_en: { type: string }
        bl_status_en: { type: string }
        bl_type_en: { type: string }
  source:
    file: "geo_licenses.sql"
  enabled: true
  policies:
    output:
      - condition: "user.role == 'guest'"
        action: mask_fields
        fields: [
          # Personal Information
          "owner_nationality_en",
          "owner_nationality_ar",
          "owner_gender",
          "bl_full_address",
          # Business Information
          "bl_name_en",
          "bl_name_ar",
          "bl_cbls",
          "business_activity_code",
          "business_activity_desc_en",
          "business_activity_desc_ar",
          # Relationship Information
          "relationship_type_en",
          "relationship_type_ar",
          "parent_licence_license_number",
          "parent_license_issuance_authority_en",
          "parent_license_issuance_authority_ar",
          # Location Information
          "license_latitude",
          "license_longitude",
          "license_latitude_1",
          "license_longitude_1"
        ]
        reason: "Guest users cannot view sensitive business, personal, or precise location information"
      - condition: "user.role == 'guest'"
        action: filter_fields
        fields: [
          "lat_dd",
          "lon_dd"
        ]
        reason: "Guest users cannot view precise coordinates"
  # tests:
  #   - name: "bbox"
  #     arguments:
  #       - { key: "bbox", value: "54.0,24.0,56.0,25.0" }
  #       - { key: "emirate_name_en", value: "Dubai" }
  #       - { key: "page_size", value: 1 }
  #     result: ">= 1 row"
