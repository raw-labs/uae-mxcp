mxcp: 1.0.0
tool:
  name: timeseries_licenses
  description: Analyze licenses trends over time
  parameters:
  - name: timeField
    type: string
    description: Date field to analyze
    enum:
    - bl_est_date
    - bl_exp_date
    - bl_est_date_d
    - bl_exp_date_d
    default: bl_est_date
  - name: granularity
    type: string
    description: Time granularity
    enum:
    - day
    - week
    - month
    - quarter
    - year
    default: month
  - name: startDate
    type: string
    format: date
    description: Start date (YYYY-MM-DD)
    default: null
  - name: endDate
    type: string
    format: date
    description: End date (YYYY-MM-DD)
    default: null
  - name: LicensePk
    type: string
    description: Filter by license_pk
  - name: Bl
    type: string
    description: Filter by bl
  - name: BlCbls
    type: string
    description: Filter by bl_cbls
  - name: EmirateNameEn
    type: string
    description: Filter by emirate_name_en
    enum:
    - Dubai
    - Abu Dhabi
    - Sharjah
    - Ajman
    - Ras Al Khaimah
    - Fujairah
    - Umm Al Quwain
    - Umm Al-Quwain
    - null
  - name: EmirateNameAr
    type: string
    description: Filter by emirate_name_ar
  - name: IssuanceAuthorityEn
    type: string
    description: Filter by issuance_authority_en
  - name: IssuanceAuthorityAr
    type: string
    description: Filter by issuance_authority_ar
  - name: IssuanceAuthorityBranchEn
    type: string
    description: Filter by issuance_authority_branch_en
  - name: IssuanceAuthorityBranchAr
    type: string
    description: Filter by issuance_authority_branch_ar
  - name: BlStatusEn
    type: string
    description: Filter by bl_status_en
    enum:
    - Active
    - Expired
    - Cancelled
    - Current
    - On Hold
    - In  Active
    - Inactive
    - Blocked
    - Suspended
    - Under Liquidation
    - Under Commercial Liquidation
    - Under Commercial Liquidation.
    - Under Commercial Liquida
    - Under Commercial Mortgage
    - null
  - name: BlEstDateDFrom
    type: string
    format: date
    description: Filter bl_est_date_d from date (YYYY-MM-DD)
  - name: BlEstDateDTo
    type: string
    format: date
    description: Filter bl_est_date_d to date (YYYY-MM-DD)
  - name: BlExpDateDFrom
    type: string
    format: date
    description: Filter bl_exp_date_d from date (YYYY-MM-DD)
  - name: BlExpDateDTo
    type: string
    format: date
    description: Filter bl_exp_date_d to date (YYYY-MM-DD)
  required: []
  return:
    type: array
    items:
      type: object
      properties:
        period:
          type: string
          format: date
        count:
          type: integer
        unique_records:
          type: integer
  source:
    file: ../sql/timeseries_licenses.sql
  enabled: true
  tests:
    - name: test_basic_timeseries
      description: Test basic timeseries functionality
      arguments: {}
      assertions:
        - result_count: ">= 1"
        - field_exists: "time_period"
        - field_exists: "license_count"
        - field_type:
            field: "license_count"
            type: "integer"
    
    - name: test_monthly_granularity
      description: Test monthly granularity
      arguments:
        - key: "granularity"
          value: "month"
      assertions:
        - result_count: ">= 1"
        - field_exists: "time_period"
    
    - name: test_yearly_granularity
      description: Test yearly granularity
      arguments:
        - key: "granularity"
          value: "year"
      assertions:
        - result_count: ">= 1"
        - field_exists: "time_period"
