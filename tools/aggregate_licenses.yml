mxcp: 1.0.0
tool:
  name: aggregate_licenses
  description: Aggregate licenses data by various dimensions
  parameters:
  - name: group_by
    type: array
    items:
      type: string
      enum:
      - LicensePk
      - Bl
      - BlCbls
      - EmirateNameEn
      - EmirateNameAr
      - IssuanceAuthorityEn
      - IssuanceAuthorityAr
      - IssuanceAuthorityBranchEn
      - IssuanceAuthorityBranchAr
      - BlStatusEn
      - BlStatusAr
      - BlNameEn
      - BlNameAr
      - BlLegalTypeEn
      - BlLegalTypeAr
      - BlTypeEn
      - BlTypeAr
      - LicenseBranchFlag
      - ParentLicenseIssuanceAuthorityEn
      - ParentLicenseIssuanceAuthorityAr
      - RelationshipTypeEn
      - RelationshipTypeAr
      - OwnerNationalityAr
      - OwnerGender
      - OwnerNationalityEn
      - BusinessActivityDescEn
      - BusinessActivityDescAr
      - LicenseLatitude
      - LicenseLongitude
      - LicenseLatitude1
      - LicenseLongitude1
      - LicensePk
      - EmirateNameEn
      - EmirateNameAr
      - BlNameEn
      - BlNameAr
      - ParentLicenceLicenseNumber
      - BusinessActivityCode
      - BlEstDate
      - BlExpDate
      - BlFullAddress
    description: Fields to group by (can select multiple)
  - name: LicensePk
    type: string
    description: Filter by license_pk
  - name: Bl
    type: string
    description: Filter by bl
  - name: BlCbls
    type: string
    description: Filter by bl_cbls
  - name: EmirateNameEn
    type: string
    description: Filter by emirate_name_en
    enum:
    - Dubai
    - Abu Dhabi
    - Sharjah
    - Ajman
    - Ras Al Khaimah
    - Fujairah
    - Umm Al Quwain
    - Umm Al-Quwain
    - null
  - name: EmirateNameAr
    type: string
    description: Filter by emirate_name_ar
  - name: IssuanceAuthorityEn
    type: string
    description: Filter by issuance_authority_en
  - name: IssuanceAuthorityAr
    type: string
    description: Filter by issuance_authority_ar
  - name: IssuanceAuthorityBranchEn
    type: string
    description: Filter by issuance_authority_branch_en
  - name: IssuanceAuthorityBranchAr
    type: string
    description: Filter by issuance_authority_branch_ar
  - name: BlStatusEn
    type: string
    description: Filter by bl_status_en
    enum:
    - Active
    - Expired
    - Cancelled
    - Current
    - On Hold
    - In  Active
    - Inactive
    - Blocked
    - Suspended
    - Under Liquidation
    - Under Commercial Liquidation
    - Under Commercial Liquidation.
    - Under Commercial Liquida
    - Under Commercial Mortgage
    - null
  - name: BlStatusAr
    type: string
    description: Filter by bl_status_ar
  - name: BlNameEn
    type: string
    description: Filter by bl_name_en
  - name: BlNameAr
    type: string
    description: Filter by bl_name_ar
  - name: BlLegalTypeEn
    type: string
    description: Filter by bl_legal_type_en
  - name: BlLegalTypeAr
    type: string
    description: Filter by bl_legal_type_ar
  - name: BlEstDateFrom
    type: string
    format: date
    description: Filter bl_est_date_d from date (YYYY-MM-DD)
  - name: BlEstDateTo
    type: string
    format: date
    description: Filter bl_est_date_d to date (YYYY-MM-DD)
  - name: BlExpDateFrom
    type: string
    format: date
    description: Filter bl_exp_date_d from date (YYYY-MM-DD)
  - name: BlExpDateTo
    type: string
    format: date
    description: Filter bl_exp_date_d to date (YYYY-MM-DD)
  - name: BlEstDateDFrom
    type: string
    format: date
    description: Filter bl_est_date_d from date (YYYY-MM-DD)
  - name: BlEstDateDTo
    type: string
    format: date
    description: Filter bl_est_date_d to date (YYYY-MM-DD)
  - name: BlExpDateDFrom
    type: string
    format: date
    description: Filter bl_exp_date_d from date (YYYY-MM-DD)
  - name: BlExpDateDTo
    type: string
    format: date
    description: Filter bl_exp_date_d to date (YYYY-MM-DD)
  required: []
  return:
    type: array
    items:
      type: object
  source:
    file: ../sql/aggregate_licenses.sql
  enabled: true
  tests:
  - name: test_manual_aggregation
    description: Manual aggregation test that should be preserved (updated for new
      parameter format)
    arguments:
    - key: group_by
      value:
      - EmirateNameEn
    - key: EmirateNameEn
      value: Dubai
    result: data_returned
