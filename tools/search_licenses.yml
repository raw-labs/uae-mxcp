mxcp: 1.0.0
tool:
  name: "search_licenses"
  description: "Flexible search for UAE business licenses with deep filtering."
  tags: ["search", "licenses", "uae", "deep-filters"]
  annotations:
    title: "Search Licenses"
    readOnlyHint: true
    destructiveHint: false
    idempotentHint: true
    openWorldHint: false
  parameters:
    - { name: "page", type: "integer", description: "Page number (1-based)", default: 1, minimum: 1 }
    - { name: "page_size", type: "integer", description: "Number of records per page", default: 20, minimum: 1, maximum: 1000 }
    - { name: "emirate_name_en", type: "string", description: "Emirate (EN) exact match", default: null, examples: ["Dubai"] }
    - { name: "emirate_name_en_like", type: "string", description: "Emirate (EN) substring match", default: null, examples: ["Dub"] }
    - { name: "emirate_name_ar", type: "string", description: "Emirate (AR) exact match", default: null }
    - { name: "emirate_name_ar_like", type: "string", description: "Emirate (AR) substring match", default: null }
    - { name: "issuance_authority_en", type: "string", description: "Issuance authority (EN) exact match", default: null }
    - { name: "issuance_authority_en_like", type: "string", description: "Issuance authority (EN) substring match", default: null }
    - { name: "issuance_authority_ar", type: "string", description: "Issuance authority (AR) exact match", default: null }
    - { name: "issuance_authority_ar_like", type: "string", description: "Issuance authority (AR) substring match", default: null }
    - { name: "issuance_authority_branch_en", type: "string", description: "Branch (EN) exact match", default: null }
    - { name: "issuance_authority_branch_en_like", type: "string", description: "Branch (EN) substring match", default: null }
    - { name: "issuance_authority_branch_ar", type: "string", description: "Branch (AR) exact match", default: null }
    - { name: "issuance_authority_branch_ar_like", type: "string", description: "Branch (AR) substring match", default: null }
    - { name: "bl_num", type: "string", description: "License number exact match", default: null }
    - { name: "bl_num_like", type: "string", description: "License number substring match", default: null }
    - { name: "bl_cbls_num", type: "string", description: "CBLS number exact match", default: null }
    - { name: "bl_cbls_num_like", type: "string", description: "CBLS number substring match", default: null }
    - { name: "bl_name_ar", type: "string", description: "Trade name (AR) exact match", default: null }
    - { name: "bl_name_ar_like", type: "string", description: "Trade name (AR) substring match", default: null }
    - { name: "bl_name_en", type: "string", description: "Trade name (EN) exact match", default: null }
    - { name: "bl_name_en_like", type: "string", description: "Trade name (EN) substring match", default: null }
    - { name: "bl_est_date_from", type: "string", format: "date", description: "Establishment date from (YYYY-MM-DD)", default: null }
    - { name: "bl_est_date_to", type: "string", format: "date", description: "Establishment date to (YYYY-MM-DD)", default: null }
    - { name: "bl_exp_date_from", type: "string", format: "date", description: "Expiry date from (YYYY-MM-DD)", default: null }
    - { name: "bl_exp_date_to", type: "string", format: "date", description: "Expiry date to (YYYY-MM-DD)", default: null }
    - { name: "bl_status_en", type: "string", description: "Status (EN) exact match", default: null }
    - { name: "bl_status_en_like", type: "string", description: "Status (EN) substring match", default: null }
    - { name: "bl_status_ar", type: "string", description: "Status (AR) exact match", default: null }
    - { name: "bl_status_ar_like", type: "string", description: "Status (AR) substring match", default: null }
    - { name: "bl_legal_type_en", type: "string", description: "Legal type (EN) exact match", default: null }
    - { name: "bl_legal_type_en_like", type: "string", description: "Legal type (EN) substring match", default: null }
    - { name: "bl_legal_type_ar", type: "string", description: "Legal type (AR) exact match", default: null }
    - { name: "bl_legal_type_ar_like", type: "string", description: "Legal type (AR) substring match", default: null }
    - { name: "bl_type_en", type: "string", description: "License type (EN) exact match", default: null }
    - { name: "bl_type_en_like", type: "string", description: "License type (EN) substring match", default: null }
    - { name: "bl_type_ar", type: "string", description: "License type (AR) exact match", default: null }
    - { name: "bl_type_ar_like", type: "string", description: "License type (AR) substring match", default: null }
    - { name: "bl_full_address", type: "string", description: "Full address exact match", default: null }
    - { name: "bl_full_address_like", type: "string", description: "Full address substring match", default: null }
    - { name: "license_latitude_min", type: "number", description: "Minimum latitude", default: null }
    - { name: "license_latitude_max", type: "number", description: "Maximum latitude", default: null }
    - { name: "license_longitude_min", type: "number", description: "Minimum longitude", default: null }
    - { name: "license_longitude_max", type: "number", description: "Maximum longitude", default: null }
    - { name: "license_branch_flag", type: "string", description: "Branch flag (Y/N)", default: null }
    - { name: "parent_licence_license_number", type: "string", description: "Parent license number exact match", default: null }
    - { name: "parent_licence_license_number_like", type: "string", description: "Parent license number substring match", default: null }
    - { name: "parent_license_issuance_authority_en", type: "string", description: "Parent authority (EN) exact match", default: null }
    - { name: "parent_license_issuance_authority_en_like", type: "string", description: "Parent authority (EN) substring match", default: null }
    - { name: "parent_license_issuance_authority_ar", type: "string", description: "Parent authority (AR) exact match", default: null }
    - { name: "parent_license_issuance_authority_ar_like", type: "string", description: "Parent authority (AR) substring match", default: null }
    - { name: "relationship_type_en", type: "string", description: "Relationship role (EN) exact match", default: null }
    - { name: "relationship_type_en_like", type: "string", description: "Relationship role (EN) substring match", default: null }
    - { name: "relationship_type_ar", type: "string", description: "Relationship role (AR) exact match", default: null }
    - { name: "relationship_type_ar_like", type: "string", description: "Relationship role (AR) substring match", default: null }
    - { name: "owner_nationality_en", type: "string", description: "Owner nationality (EN) exact match", default: null }
    - { name: "owner_nationality_en_like", type: "string", description: "Owner nationality (EN) substring match", default: null }
    - { name: "owner_nationality_ar", type: "string", description: "Owner nationality (AR) exact match", default: null }
    - { name: "owner_nationality_ar_like", type: "string", description: "Owner nationality (AR) substring match", default: null }
    - { name: "owner_gender", type: "string", description: "Owner gender exact match", default: null }
    - { name: "business_activity_code", type: "string", description: "Business activity code exact match", default: null }
    - { name: "business_activity_code_like", type: "string", description: "Business activity code substring match", default: null }
    - { name: "business_activity_desc_en", type: "string", description: "Business activity description (EN) exact match", default: null }
    - { name: "business_activity_desc_en_like", type: "string", description: "Business activity description (EN) substring match", default: null }
    - { name: "business_activity_desc_ar", type: "string", description: "Business activity description (AR) exact match", default: null }
    - { name: "business_activity_desc_ar_like", type: "string", description: "Business activity description (AR) substring match", default: null }
  return:
    type: array
    items:
      type: object
      properties:
        license_pk: { type: string }
        emirate_name_en: { type: string }
        emirate_name_ar: { type: string }
        issuance_authority_en: { type: string }
        issuance_authority_ar: { type: string }
        issuance_authority_branch_en: { type: string }
        issuance_authority_branch_ar: { type: string }
        bl: { type: string }
        bl_cbls: { type: string }
        bl_name_ar: { type: string }
        bl_name_en: { type: string }
        bl_est_date: { type: string }
        bl_exp_date: { type: string }
        bl_status_en: { type: string }
        bl_status_ar: { type: string }
        bl_legal_type_en: { type: string }
        bl_legal_type_ar: { type: string }
        bl_type_en: { type: string }
        bl_type_ar: { type: string }
        bl_full_address: { type: string }
        license_latitude: { type: string }
        license_longitude: { type: string }
        license_branch_flag: { type: string }
        parent_licence_license_number: { type: string }
        parent_license_issuance_authority_en: { type: string }
        parent_license_issuance_authority_ar: { type: string }
        relationship_type_en: { type: string }
        relationship_type_ar: { type: string }
        owner_nationality_en: { type: string }
        owner_nationality_ar: { type: string }
        owner_gender: { type: string }
        business_activity_code: { type: string }
        business_activity_desc_en: { type: string }
        business_activity_desc_ar: { type: string }
        license_latitude_1: { type: string }
        license_longitude_1: { type: string }
        bl_est_date_d: { type: string, format: date }
        bl_exp_date_d: { type: string, format: date }
        lat_dd: { type: number }
        lon_dd: { type: number }
  source:
    file: "search_licenses.sql"
  enabled: true
  # tests:
  #   - name: "basic"
  #     arguments:
  #       - { key: "emirate_name_en", value: "Dubai" }
  #       - { key: "page_size", value: 1 }
  #     result: ">= 1 row"
  policies:
    output:
      - condition: "user.role == 'guest'"
        action: mask_fields
        fields: [
          # Personal Information
          "owner_nationality_en",
          "owner_nationality_ar",
          "owner_gender",
          "bl_full_address",
          # Business Information
          "bl_name_en",
          "bl_name_ar",
          "bl_cbls",
          "business_activity_code",
          "business_activity_desc_en",
          "business_activity_desc_ar",
          # Relationship Information
          "relationship_type_en",
          "relationship_type_ar",
          "parent_licence_license_number",
          "parent_license_issuance_authority_en",
          "parent_license_issuance_authority_ar"
        ]
        reason: "Guest users cannot view sensitive business or personal information" 