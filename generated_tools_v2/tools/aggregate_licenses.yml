mxcp: 1.0.0
tool:
  name: aggregate_licenses
  description: Aggregate licenses data by various dimensions
  parameters:
  - name: groupByLicensePk
    type: boolean
    description: Group by LicensePk
    default: false
  - name: groupByBl
    type: boolean
    description: Group by Bl
    default: false
  - name: groupByCbls
    type: boolean
    description: Group by Cbls
    default: false
  - name: groupByEmirateNameEn
    type: boolean
    description: Group by EmirateNameEn
    default: false
  - name: groupByEmirateNameAr
    type: boolean
    description: Group by EmirateNameAr
    default: false
  - name: groupByIssuanceAuthorityEn
    type: boolean
    description: Group by IssuanceAuthorityEn
    default: false
  - name: groupByIssuanceAuthorityAr
    type: boolean
    description: Group by IssuanceAuthorityAr
    default: false
  - name: groupByIssuanceAuthorityBranchEn
    type: boolean
    description: Group by IssuanceAuthorityBranchEn
    default: false
  - name: groupByIssuanceAuthorityBranchAr
    type: boolean
    description: Group by IssuanceAuthorityBranchAr
    default: false
  - name: groupByStatusEn
    type: boolean
    description: Group by StatusEn
    default: false
  - name: groupByStatusAr
    type: boolean
    description: Group by StatusAr
    default: false
  - name: groupByNameEn
    type: boolean
    description: Group by NameEn
    default: false
  - name: groupByNameAr
    type: boolean
    description: Group by NameAr
    default: false
  - name: groupByLegalTypeEn
    type: boolean
    description: Group by LegalTypeEn
    default: false
  - name: groupByLegalTypeAr
    type: boolean
    description: Group by LegalTypeAr
    default: false
  - name: groupByTypeEn
    type: boolean
    description: Group by TypeEn
    default: false
  - name: groupByTypeAr
    type: boolean
    description: Group by TypeAr
    default: false
  - name: groupByLicenseBranchFlag
    type: boolean
    description: Group by LicenseBranchFlag
    default: false
  - name: groupByParentLicenseIssuanceAuthorityEn
    type: boolean
    description: Group by ParentLicenseIssuanceAuthorityEn
    default: false
  - name: groupByParentLicenseIssuanceAuthorityAr
    type: boolean
    description: Group by ParentLicenseIssuanceAuthorityAr
    default: false
  - name: groupByRelationshipTypeEn
    type: boolean
    description: Group by RelationshipTypeEn
    default: false
  - name: groupByRelationshipTypeAr
    type: boolean
    description: Group by RelationshipTypeAr
    default: false
  - name: groupByOwnerNationalityAr
    type: boolean
    description: Group by OwnerNationalityAr
    default: false
  - name: groupByOwnerGender
    type: boolean
    description: Group by OwnerGender
    default: false
  - name: groupByOwnerNationalityEn
    type: boolean
    description: Group by OwnerNationalityEn
    default: false
  - name: groupByBusinessActivityDescEn
    type: boolean
    description: Group by BusinessActivityDescEn
    default: false
  - name: groupByBusinessActivityDescAr
    type: boolean
    description: Group by BusinessActivityDescAr
    default: false
  - name: groupByLicenseLatitude
    type: boolean
    description: Group by LicenseLatitude
    default: false
  - name: groupByLicenseLongitude
    type: boolean
    description: Group by LicenseLongitude
    default: false
  - name: groupByLicenseLatitude1
    type: boolean
    description: Group by LicenseLatitude1
    default: false
  - name: groupByLicenseLongitude1
    type: boolean
    description: Group by LicenseLongitude1
    default: false
  - name: groupByEstDate
    type: boolean
    description: Group by EstDate
    default: false
  - name: groupByExpDate
    type: boolean
    description: Group by ExpDate
    default: false
  - name: groupByFullAddress
    type: boolean
    description: Group by FullAddress
    default: false
  - name: groupByParentLicenceLicenseNumber
    type: boolean
    description: Group by ParentLicenceLicenseNumber
    default: false
  - name: groupByBusinessActivityCode
    type: boolean
    description: Group by BusinessActivityCode
    default: false
  - name: filterLicensePk
    type: string
    description: Filter by LicensePk
  - name: filterBl
    type: string
    description: Filter by Bl
  - name: filterCbls
    type: string
    description: Filter by Cbls
  - name: filterEmirateNameEn
    type: string
    description: Filter by EmirateNameEn
  - name: filterEmirateNameAr
    type: string
    description: Filter by EmirateNameAr
  - name: filterIssuanceAuthorityEn
    type: string
    description: Filter by IssuanceAuthorityEn
  - name: filterIssuanceAuthorityAr
    type: string
    description: Filter by IssuanceAuthorityAr
  - name: filterIssuanceAuthorityBranchEn
    type: string
    description: Filter by IssuanceAuthorityBranchEn
  - name: filterIssuanceAuthorityBranchAr
    type: string
    description: Filter by IssuanceAuthorityBranchAr
  - name: filterStatusEn
    type: string
    description: Filter by StatusEn
  - name: EstDateFrom
    type: string
    format: date
    description: Filter EstDate from date (YYYY-MM-DD)
  - name: EstDateTo
    type: string
    format: date
    description: Filter EstDate to date (YYYY-MM-DD)
  - name: ExpDateFrom
    type: string
    format: date
    description: Filter ExpDate from date (YYYY-MM-DD)
  - name: ExpDateTo
    type: string
    format: date
    description: Filter ExpDate to date (YYYY-MM-DD)
  return:
    type: array
    items:
      type: object
  source:
    code: "SELECT\n  CASE WHEN $groupByLicensePk THEN license_pk ELSE 'All' END as\
      \ license_pk,\n  CASE WHEN $groupByBl THEN bl ELSE 'All' END as bl,\n  CASE\
      \ WHEN $groupByCbls THEN bl_cbls ELSE 'All' END as bl_cbls,\n  CASE WHEN $groupByEmirateNameEn\
      \ THEN emirate_name_en ELSE 'All' END as emirate_name_en,\n  CASE WHEN $groupByEmirateNameAr\
      \ THEN emirate_name_ar ELSE 'All' END as emirate_name_ar,\n  CASE WHEN $groupByIssuanceAuthorityEn\
      \ THEN issuance_authority_en ELSE 'All' END as issuance_authority_en,\n  CASE\
      \ WHEN $groupByIssuanceAuthorityAr THEN issuance_authority_ar ELSE 'All' END\
      \ as issuance_authority_ar,\n  CASE WHEN $groupByIssuanceAuthorityBranchEn THEN\
      \ issuance_authority_branch_en ELSE 'All' END as issuance_authority_branch_en,\n\
      \  CASE WHEN $groupByIssuanceAuthorityBranchAr THEN issuance_authority_branch_ar\
      \ ELSE 'All' END as issuance_authority_branch_ar,\n  CASE WHEN $groupByStatusEn\
      \ THEN bl_status_en ELSE 'All' END as bl_status_en,\n  CASE WHEN $groupByStatusAr\
      \ THEN bl_status_ar ELSE 'All' END as bl_status_ar,\n  CASE WHEN $groupByNameEn\
      \ THEN bl_name_en ELSE 'All' END as bl_name_en,\n  CASE WHEN $groupByNameAr\
      \ THEN bl_name_ar ELSE 'All' END as bl_name_ar,\n  CASE WHEN $groupByLegalTypeEn\
      \ THEN bl_legal_type_en ELSE 'All' END as bl_legal_type_en,\n  CASE WHEN $groupByLegalTypeAr\
      \ THEN bl_legal_type_ar ELSE 'All' END as bl_legal_type_ar,\n  CASE WHEN $groupByTypeEn\
      \ THEN bl_type_en ELSE 'All' END as bl_type_en,\n  CASE WHEN $groupByTypeAr\
      \ THEN bl_type_ar ELSE 'All' END as bl_type_ar,\n  CASE WHEN $groupByLicenseBranchFlag\
      \ THEN license_branch_flag ELSE 'All' END as license_branch_flag,\n  CASE WHEN\
      \ $groupByParentLicenseIssuanceAuthorityEn THEN parent_license_issuance_authority_en\
      \ ELSE 'All' END as parent_license_issuance_authority_en,\n  CASE WHEN $groupByParentLicenseIssuanceAuthorityAr\
      \ THEN parent_license_issuance_authority_ar ELSE 'All' END as parent_license_issuance_authority_ar,\n\
      \  CASE WHEN $groupByRelationshipTypeEn THEN relationship_type_en ELSE 'All'\
      \ END as relationship_type_en,\n  CASE WHEN $groupByRelationshipTypeAr THEN\
      \ relationship_type_ar ELSE 'All' END as relationship_type_ar,\n  CASE WHEN\
      \ $groupByOwnerNationalityAr THEN owner_nationality_ar ELSE 'All' END as owner_nationality_ar,\n\
      \  CASE WHEN $groupByOwnerGender THEN owner_gender ELSE 'All' END as owner_gender,\n\
      \  CASE WHEN $groupByOwnerNationalityEn THEN owner_nationality_en ELSE 'All'\
      \ END as owner_nationality_en,\n  CASE WHEN $groupByBusinessActivityDescEn THEN\
      \ business_activity_desc_en ELSE 'All' END as business_activity_desc_en,\n \
      \ CASE WHEN $groupByBusinessActivityDescAr THEN business_activity_desc_ar ELSE\
      \ 'All' END as business_activity_desc_ar,\n  CASE WHEN $groupByLicenseLatitude\
      \ THEN license_latitude ELSE 'All' END as license_latitude,\n  CASE WHEN $groupByLicenseLongitude\
      \ THEN license_longitude ELSE 'All' END as license_longitude,\n  CASE WHEN $groupByLicenseLatitude1\
      \ THEN license_latitude_1 ELSE 'All' END as license_latitude_1,\n  CASE WHEN\
      \ $groupByLicenseLongitude1 THEN license_longitude_1 ELSE 'All' END as license_longitude_1,\n\
      \  CASE WHEN $groupByEstDate THEN bl_est_date ELSE 'All' END as bl_est_date,\n\
      \  CASE WHEN $groupByExpDate THEN bl_exp_date ELSE 'All' END as bl_exp_date,\n\
      \  CASE WHEN $groupByFullAddress THEN bl_full_address ELSE 'All' END as bl_full_address,\n\
      \  CASE WHEN $groupByParentLicenceLicenseNumber THEN parent_licence_license_number\
      \ ELSE 'All' END as parent_licence_license_number,\n  CASE WHEN $groupByBusinessActivityCode\
      \ THEN business_activity_code ELSE 'All' END as business_activity_code,\n  COUNT(*)\
      \ as total_count,\n  COUNT(DISTINCT license_pk) as unique_licenses\nFROM dim_licenses\n\
      WHERE 1=1\n  AND ($filterLicensePk IS NULL OR license_pk = $filterLicensePk)\n\
      \  AND ($filterBl IS NULL OR bl = $filterBl)\n  AND ($filterCbls IS NULL OR\
      \ bl_cbls = $filterCbls)\n  AND ($filterEmirateNameEn IS NULL OR emirate_name_en\
      \ = $filterEmirateNameEn)\n  AND ($filterEmirateNameAr IS NULL OR emirate_name_ar\
      \ = $filterEmirateNameAr)\n  AND ($filterIssuanceAuthorityEn IS NULL OR issuance_authority_en\
      \ = $filterIssuanceAuthorityEn)\n  AND ($filterIssuanceAuthorityAr IS NULL OR\
      \ issuance_authority_ar = $filterIssuanceAuthorityAr)\n  AND ($filterIssuanceAuthorityBranchEn\
      \ IS NULL OR issuance_authority_branch_en = $filterIssuanceAuthorityBranchEn)\n\
      \  AND ($filterIssuanceAuthorityBranchAr IS NULL OR issuance_authority_branch_ar\
      \ = $filterIssuanceAuthorityBranchAr)\n  AND ($filterStatusEn IS NULL OR bl_status_en\
      \ = $filterStatusEn)\n  AND ($EstDateFrom IS NULL OR bl_est_date_d >= $EstDateFrom::DATE)\n\
      \  AND ($EstDateTo IS NULL OR bl_est_date_d <= $EstDateTo::DATE)\n  AND ($ExpDateFrom\
      \ IS NULL OR bl_exp_date_d >= $ExpDateFrom::DATE)\n  AND ($ExpDateTo IS NULL\
      \ OR bl_exp_date_d <= $ExpDateTo::DATE)\nGROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9,\
      \ 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28,\
      \ 29, 30, 31, 32, 33, 34, 35, 36\nORDER BY total_count DESC\nLIMIT 100"
  enabled: true
